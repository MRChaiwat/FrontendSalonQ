<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Test</title>
    <!-- Tailwind CSS for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap');
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
        }
    </style>
</head>
<body>

    <div class="container bg-white rounded-xl shadow-lg p-8 space-y-6">
        <h1 class="text-3xl font-bold text-center text-gray-800">ทดสอบการเชื่อมต่อ LIFF</h1>
        <p class="text-center text-gray-600">สถานะการเชื่อมต่อจะแสดงด้านล่าง</p>

        <!-- Display Area -->
        <div id="statusSection" class="p-4 rounded-lg text-center">
            <p id="statusMessage" class="font-medium text-gray-700">กำลังโหลด LIFF SDK...</p>
        </div>
        
        <div id="userInfo" class="hidden p-6 bg-gray-100 rounded-lg space-y-3">
            <h2 class="text-xl font-semibold text-gray-800">ข้อมูลผู้ใช้</h2>
            <p><strong>ชื่อ:</strong> <span id="displayName" class="text-blue-600"></span></p>
            <p><strong>User ID:</strong> <span id="userId" class="text-green-600 break-all"></span></p>
        </div>
    </div>

    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/2.22.3/liff.js"></script>
    <script>
        // *** Important! ***
        // Change this LIFF ID to the one you want to test.
        const liffId = '2007895406-VWgOqgvW'; 

        const statusSection = document.getElementById('statusSection');
        const statusMessage = document.getElementById('statusMessage');
        const userInfoDiv = document.getElementById('userInfo');
        const displayNameSpan = document.getElementById('displayName');
        const userIdSpan = document.getElementById('userId');

        // Main function to initialize LIFF
        async function initializeLiff() {
            try {
                // Check if LIFF SDK is loaded
                if (typeof liff === 'undefined') {
                    console.error('LIFF SDK is not loaded. Retrying in 1 second.');
                    statusMessage.textContent = '❌ LIFF SDK ไม่สามารถโหลดได้ กรุณาตรวจสอบการเชื่อมต่ออินเทอร์เน็ต';
                    statusSection.classList.remove('bg-gray-100');
                    statusSection.classList.add('bg-red-100');
                    // Retry initialization after a short delay
                    setTimeout(initializeLiff, 1000);
                    return;
                }

                // Show status message
                statusMessage.textContent = 'กำลังเชื่อมต่อกับ LIFF...';
                statusSection.classList.remove('bg-green-100', 'bg-red-100');
                statusSection.classList.add('bg-gray-100');
                
                // Initialize LIFF SDK
                await liff.init({ liffId: liffId });

                // Check if user is logged in
                if (liff.isLoggedIn()) {
                    // If logged in, get user profile
                    const profile = await liff.getProfile();
                    
                    // Display user information
                    displayNameSpan.textContent = profile.displayName;
                    userIdSpan.textContent = profile.userId;

                    // Show user info section
                    userInfoDiv.classList.remove('hidden');

                    // Display success message
                    statusMessage.textContent = '✅ เชื่อมต่อสำเร็จและดึงข้อมูลผู้ใช้ได้แล้ว!';
                    statusSection.classList.remove('bg-gray-100');
                    statusSection.classList.add('bg-green-100');
                    console.log('LIFF initialization successful. User Profile:', profile);
                } else {
                    // If not logged in, redirect to the login page
                    statusMessage.textContent = 'กรุณาเข้าสู่ระบบ LINE เพื่อดำเนินการต่อ...';
                    statusSection.classList.remove('bg-gray-100');
                    statusSection.classList.add('bg-yellow-100');
                    liff.login();
                }
            } catch (error) {
                // Handle LIFF initialization errors
                statusMessage.textContent = '❌ เกิดข้อผิดพลาดในการเชื่อมต่อ LIFF: ' + error.message;
                statusSection.classList.remove('bg-gray-100');
                statusSection.classList.add('bg-red-100');
                console.error('LIFF initialization failed:', error);
            }
        }
        
        // Start the process when the page loads
        window.onload = function() {
            initializeLiff();
        };
    </script>
</body>
</html>
